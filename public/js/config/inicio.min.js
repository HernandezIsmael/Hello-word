function HoneyInicio(){
	var that = this, tabla = $('<tbody></tbody>').attr('id', 'tbody_inicio'), token = $("#token_").val(); 
	var btn_insert = $("#btn_creinicio"), btn_update = $("#btn_updinicio"), btn_delte = $("#btn_delinicio");
	
	$("#btn_reg").click(function(){ that.Muestra(1); that.Panel(2); });

	$(document).on('click', '#btn_editini', function(e){ e.preventDefault(); that.Muestra(2); that.BuscaDatos(this.value, 2); });

	$(document).on('click', '#btn_deleteini', function(e){ e.preventDefault(); that.Muestra(3); that.BuscaDatos(this.value, 2); });

	$("#btn_table").click(function(){ that.Panel(1); });

	btn_insert.click(function(){ that.SubirImagen(1); })

	btn_update.click(function(){ that.SubirImagen(2); })

	btn_delte.click(function(){ 
		datas = {  id : clv_ini.value, titulo : tit_ini.value, imagen: null, descripcion : des_ini.value, TipoCrud: 'Eliminar' };
        that.Ajax("/cardsinicio/"+clv_ini.value+"", "DELETE", datas);
	});

	$(document).on('click', '.pagination a', function(e){
		e.preventDefault();
		var page = $(this).attr('href').split('page=')[1];
		$.ajax({
			url: '/cardsinicio',
			data: { page : page },
			type: 'GET',
			dataType: 'json',
			success : function(data){
				that.CargaDatosTabla(page, data);	
			}
		});	
	});

	that.CargaTabla = function(value){
		$("#panelbody").append($("#div-table").show());
		tabla.empty();
		$.get('/cardsinicio', function(response){
			if(value == 1){ that.CargaDatosTabla(); }else{ that.CargaDatosTabla(1, response); }	
		});
	}

	that.SubirImagen = function(value){
		var Image = $("#ruta_ini").prop("files")[0];
		var form_data = new FormData();
		form_data.append("Vch_Ruta", Image);
		$.ajax({
			url: "/uploadimgpro",
			headers: {'X-CSRF-TOKEN' : token },
			type: 'POST',
			data: form_data,
			processData: false,
            contentType: false,
            success : function(response){
            	$(response).each(function(){
            		var datas = null;
            		if(value == 1){
            			datas = {  id : clv_ini.value, titulo : tit_ini.value, imagen: this.nombre, descripcion : des_ini.value, TipoCrud: 'Insertar' };
            			that.Ajax("/cardsinicio", "POST", datas);
            		}else{
            			datas = {  id : clv_ini.value, titulo : tit_ini.value, imagen: this.nombre, descripcion : des_ini.value, TipoCrud: 'Actualizar' };
            			that.Ajax("/cardsinicio/"+clv_ini.value+"", "PUT", datas);	
            		}
            	});
            },
            error : function(){
            	alert("Error en el servidor");
            }
		});
	}

	that.BuscaDatos = function(value, opc){
		$.ajax({
			url: '/cardsinicio/'+value+"/edit",
			type: 'GET',
			dataType: 'json',
			success : function(response){
				that.Panel(opc, response);
			},
			error : function(){
				alert("error");
			}
		});
	}

	that.CargaDatosTabla = function(pagination = 0, data = null){
		var page = (pagination == 0) ? page = 1 : page = pagination;
		tabla.empty();
		$.ajax({
			url: '/tableinicio',
			data: { page : page },
			type: 'GET',
			dataType: 'json',
			beforeSend: function(){
				$('.preloader').show();
			},
			success : function(response){
				$(response.data).each(function(){
					tabla.append("<tr><td>"+this.id+"</td><td>"+this.Vch_Titulo+"</td>"+
						"<td><img src='images/"+this.Vch_RutaImagen+"' style='width:100px;'></td><td>"+this.Vch_Descripcion+"</td>"+
						"<td><button class='btn btn-success' id='btn_editini' value="+this.id+">Editar</button></td>"+
						"<td><button class='btn btn-danger' id='btn_deleteini' value="+this.id+">Eliminar</button></td></tr>");
				});
				$("#tableinicio").append(tabla);
				if(data != null){ $("#render").html(data); }
				$('.preloader').hide();	
			}
		});
	}

	that.Panel = function(value, data = null){
		if(value ==1){
			$("#div-reg").hide();
			return that.CargaTabla(0);			
		}else{
			if(value == 2){
				$("#div-table").hide();
				if(data != null){
					$(data).each(function(){
						$("#clv_ini").val(this.id); $("#tit_ini").val(this.Vch_Titulo); $("#des_ini").val(this.Vch_Descripcion)
					});
				}
				return $("#panelbody").append($("#div-reg").show());
			}else{
				$("#div-reg").hide();
				return that.CargaTabla(2);
			}
		}
	}

	that.Ajax = function(Route, Types, Data){
		$.ajax({
			url: Route,
			headers: {'X-CSRF-TOKEN' : token },
			type: Types,
			dataType: 'json',
			data: Data,
			success : function(response){
				$(response).each(function(){
					if(this.Bln_Bandera == 1){
						if($("#alert_cruds").hasClass('alert-danger')){
							$("#alert_cruds").removeClass('alert-danger');
							$("#alert_cruds").addClass('alert-success');			
						}
						$("#alert_cruds").fadeIn();
						$("#alert_cruds #txt_response").text(this.Vch_Mensaje);	
					}else{
						if($("#alert_cruds").hasClass('alert-success')){
							$("#alert_cruds").removeClass('alert-success');
							$("#alert_cruds").addClass('alert-danger');	
						}
						$("#alert_cruds").fadeIn();
						$("#alert_cruds #txt_response").text(this.Vch_Mensaje);
					}
					that.Panel(3);
				});
			},
			error : function(){
				alert("Error");
			}
		});	
	}

	that.Muestra = function(value){
		btn_insert = (value == 1) ? btn_insert.show() : btn_insert.hide();
		btn_update = (value == 2) ? btn_update.show() : btn_update.hide();
		btn_delte = (value == 3) ? btn_delte.show() : btn_delte.hide();
	}	
}

var honey = new HoneyInicio();

$(document).ready(function(){
	honey.CargaTabla(0);
});

/*$(document).ready(function() {
  $.ajaxSetup({ cache: true });
  $.getScript('//connect.facebook.net/en_US/sdk.js', function(){
    FB.init({
      appId: '{your-app-id}',
      version: 'v2.5' // or v2.0, v2.1, v2.2, v2.3
    });     
    $('#loginbutton,#feedbutton').removeAttr('disabled');
    FB.getLoginStatus(updateStatusCallback);
  });
});*/