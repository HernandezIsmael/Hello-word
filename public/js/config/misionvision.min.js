function HoneyMYV() {
	var that = this, tabla = $('<tbody></tbody>').attr('id', 'tbody_myv'), token = $("#token_").val();
	var btn_insert = $("#btn_cremyv"), btn_update = $("#btn_updmyv"), btn_delte = $("#btn_delmyv");

	$("#btn_reg").click(function(){ that.Muestra(1); that.Panel(2); });
	
	$(document).on('click', '#btn_editmyv', function(e){ e.preventDefault(); that.Muestra(2); that.BuscaDatos(this.value, 2); });

	$(document).on('click', '#btn_delmyv', function(e){ e.preventDefault(); that.Muestra(3); that.BuscaDatos(this.value, 2); });	

	$("#btn_table").click(function(){ that.Panel(1); });

	btn_insert.click(function(){
		datas = { id : clv_myv.value, titulo : tit_myv.value, descripcion : des_myv.value, TipoCrud : 'Insertar' };
		that.Ajax("/misionvision/", "POST", datas);
	});

	btn_update.click(function(){
		datas = { id : clv_myv.value, titulo : tit_myv.value, descripcion : des_myv.value, TipoCrud : 'Actualizar' };
		that.Ajax("/misionvision/"+clv_myv.value+"", "PUT", datas);
	});

	btn_delte.click(function(){
		datas = { id : clv_myv.value, titulo : tit_myv.value, descripcion : des_myv.value, TipoCrud : 'Eliminar' };
		that.Ajax("/misionvision/"+clv_myv.value+"", "DELETE", datas);
	});

	that.BuscaDatos = function(value, opc){
		$.ajax({
			url: '/misionvision/'+value+"/edit",
			type: 'GET',
			dataType: 'json',
			success : function(response){
				that.Panel(opc, response);
			},
			error : function(){
				alert("error");
			}
		});
	}

	that.CargaTabla = function(value){
		$("#panelbody").append($("#div-table").show());
		tabla.empty();
		$.get('/misionvision', function(response){
			if(value == 1){ that.CargaDatosTabla(); }else{ that.CargaDatosTabla(1, response); }	
		});
	}

	that.CargaDatosTabla = function(pagination = 0, data = null){
		var page = (pagination == 0) ? page = 1 : page = pagination;
		tabla.empty();
		$.ajax({
			url: '/tablemyv',
			type: 'GET',
			data: { page : page },
			dataType: 'json',
			beforeSend : function(){
				$('.preloader').show();	
			},
			success : function(response){
				$(response.data).each(function(){
					tabla.append("<tr><td>"+this.id+"</td><td>"+this.titulo+"</td><td>"+this.descripcion+"</td>"+
						"<td><button class='btn btn-success' id='btn_editmyv' value="+this.id+">Editar</button></td>"+
						"<td><button class='btn btn-danger' id='btn_delmyv' value="+this.id+">Eliminar</button></td></tr>");
				});
				$("#tablemyv").append(tabla);
				if(data != null){ $("#render").html(data); }
				$('.preloader').hide();
			}
		});
	}

	that.Panel = function(value, data = null){
		if(value ==1){
			$("#div-reg").hide();
			return that.CargaTabla(0);			
		}else{
			if(value == 2){
				$("#div-table").hide();
				if(data != null){
					$(data).each(function(){
						$("#clv_myv").val(this.id); $("#tit_myv").val(this.titulo); $("#des_myv").val(this.descripcion);
					});
				}
				return $("#panelbody").append($("#div-reg").show());
			}else{
				$("#div-reg").hide();
				return that.CargaTabla(2);
			}
		}
	}

	that.Ajax = function(Route, Types, Data){
		$.ajax({
			url: Route,
			headers: {'X-CSRF-TOKEN' : token },
			type: Types,
			dataType: 'json',
			data: Data,
			success : function(response){
				$(response).each(function(){
					if(this.Bln_Bandera == 1){
						if($("#alert_cruds").hasClass('alert-danger')){
							$("#alert_cruds").removeClass('alert-danger');
							$("#alert_cruds").addClass('alert-success');			
						}
						$("#alert_cruds").fadeIn();
						$("#alert_cruds #txt_response").text(this.Vch_Mensaje);	
					}else{
						if($("#alert_cruds").hasClass('alert-success')){
							$("#alert_cruds").removeClass('alert-success');
							$("#alert_cruds").addClass('alert-danger');	
						}
						$("#alert_cruds").fadeIn();
						$("#alert_cruds #txt_response").text(this.Vch_Mensaje);
					}
					that.Panel(3);
				});
			},
			error : function(){
				alert("Error");
			}
		});	
	}

	that.Muestra = function(value){
		btn_insert = (value == 1) ? btn_insert.show() : btn_insert.hide();
		btn_update = (value == 2) ? btn_update.show() : btn_update.hide();
		btn_delte = (value == 3) ? btn_delte.show() : btn_delte.hide();
	}
}

var hmyv = new HoneyMYV();

$(document).ready(function(){
	hmyv.CargaTabla(0);
});