function HoneyUsers(){
	HoneyHope.apply(this, [$("#btn_creuser"), $("#btn_upuser"), $("#btn_deluser"), $('<tbody></tbody>').attr('id', 'tbody_user'), $("#modaluser")]);
	var Clave = $("#clave_user"), email = $("#mail_user"), nombres = $("#nom_user"), Ap = $("#ap_user"), Am = $("#am_user"), tel = $("#tel_user"), sex = $("#sex_user"), RFC = $("#rfc_user"), suc = $("#suc"), tipo = $("#tuser"), cargo = $("#cargo"), psw = $("#psw_user"), token = $("#token_user").val(), that = this;

	$("#btn_newuser").click(function(){
		that.Modal(this,1);	
	});

	that.btn1.click(function(){
		that.SubirImagen(1);
	});

	that.btn2.click(function(){
		that.SubirImagen(2);
	});

	that.btn3.click(function(){
		that.Route = "/Users/"+email.val()+"";
		that.Types = "DELETE";
		that.Datos = { vch_user: Clave.val(), nombre : nombres.val(), mail : email.val(), ap : Ap.val(), am: Am.val(), telefono: tel.val(), sexo : sex.val(), rfc : RFC.val(), id_sucursal : suc.val(), id_tipo: tipo.val(), id_cargo : cargo.val(), ruta : '', password: psw.val(), Vch_Tipo : 'Eliminar' };
		that.Ajax(token); 
	});

	$(document).on('click', '#btn_edituser', function(e){
		e.preventDefault();
		that.Route = "/Users/"+this.value+"/edit";
		that.Types = "GET";
		that.Modal(this, 2);
	});

	$(document).on('click', '#btn_deleteuser', function(e){
		e.preventDefault();
		that.Route = "/Users/"+this.value+"/edit";
		that.Types = "GET";
		that.Modal(this, 3);
	});

	that.CargaTabla = function(value){
		that.Route = "/Users";
		that.tabla.empty();
		$.get(that.Route, function(response){
			if(value == 1){ that.CargaDatosTabla(); }else{ that.CargaDatosTabla(1, response); } 
		});
	}

	that.CargaDatosTabla = function(pagination = 0, data = null){
		that.Route = "/tableusers";
		that.page = (pagination == 0)? that.page = 1 : that.page = pagination;
		that.tabla.empty();
		$.ajax({
			url: that.Route,
			data: { page : that.page },
			type: 'GET',
			dataType: 'json',
			beforeSend: function(){
				$('.preloader').show();
			},
			success : function(response){
				$(response.data).each(function(){
					that.tabla.append("<tr><td>"+this.name+"</td><td>"+this.email+"</td>"+
						"<td>"+this.Nombre+"</td><td>"+this.Ap+"</td><td>"+this.Am+"</td><td>"+this.tel+"</td>"+
						"<td>"+this.sex+"</td><td>"+this.rfc+"</td><td>"+this.sucursal+"</td><td>"+this.tipo+"</td><td>"+this.cargo+"</td><td><img src='images/"+this.ruta+"' style='width:60px;'></td>"+
						"<td><button class='btn btn-success' id='btn_edituser' value="+this.email+">Editar</button></td>"+
						"<td><button class='btn btn-danger' id='btn_deleteuser' value="+this.email+">Eliminar</button></td></tr>");
				});
				$("#tableuser").append(that.tabla);
				if(data != null){ $("#render").html(data); }
				$('.preloader').hide();
			}
		});	
	}

	that.SubirImagen = function(value){
		var Image = $("#foto_perfil").prop("files")[0];
		var form_data = new FormData();
		form_data.append("Vch_Ruta", Image);
		$.ajax({
			url: "/uploaduser",
			headers: {'X-CSRF-TOKEN' : token },
			type: 'POST',
			data: form_data,
			processData: false,
            contentType: false,
            success : function(response){
            	$(response).each(function(){
	            	if (value == 1) {
	            		that.Route = "/Users";
	            		that.Types = "POST";
	            		that.Datos = { vch_user: Clave.val(), nombre : nombres.val(), mail : email.val(), ap : Ap.val(), am: Am.val(), telefono: tel.val(), sexo : sex.val(), rfc : RFC.val(), id_sucursal : suc.val(), id_tipo: tipo.val(), id_cargo : cargo.val(), ruta : this.nombre, password: psw.val(), Vch_Tipo : 'Insertar' };
	            		that.Ajax(token);
	            	}else{
	            		that.Route = "/Users/"+email.val()+"";
	            		that.Types = "PUT";
	            		that.Datos = { vch_user: Clave.val(), nombre : nombres.val(), mail : email.val(), ap : Ap.val(), am: Am.val(), telefono: tel.val(), sexo : sex.val(), rfc : RFC.val(), id_sucursal : suc.val(), id_tipo: tipo.val(), id_cargo : cargo.val(), ruta : this.nombre, password: psw.val(), Vch_Tipo : 'Actualizar' };
	            		that.Ajax(token);
	            	}
            	});
            },
            error : function(){
            	alert("error");	
            }
		});
	}


	that.CargaCombo = function(){
		$.ajax({
		    url: "/usercomb/",
		    type: "GET",
		    contentType: "application/x-www-form-urlencoded",
		    dataType: "json",
		    success: function(response) {
		    	$(response).each(function(key, value){
		    		if(value.Sml_IdSucursal){
		    			var option = $(document.createElement('option'));
		    			option.val(this.Sml_IdSucursal);
		    			option.text(this.Sucursal);
		    			$(suc).append(option);
		    		}else{
		    			if(value.Sml_Tipo){
		    				var option = $(document.createElement('option'));
		    				option.val(this.Sml_Tipo);
		    				option.text(this.Vch_Tipo);
		    				$(tipo).append(option);
		    			}else{
		    				var option = $(document.createElement('option'));
		    				option.val(this.Sml_Cargo);
		    				option.text(this.Vch_Cargo);
		    				$(cargo).append(option);
		    			}
		    		}
		    	});               
		    },
		    error: function() {
		        alert(that.getMsj_Error());
		    }
		});	
	}

	that.LlenaModal = function(response){
		$(response).each(function(){
			$("#foto_perfil").empty();
			Clave.val(this.name); nombres.val(this.Nombre); email.val(this.email); Ap.val(this.Ap); Am.val(this.Am); tel.val(this.tel); sex.val(this.sex); RFC.val(this.rfc);
			$('#suc option:contains('+this.sucursal+')').attr('selected', 'selected');
			$('#tuser option:contains('+this.tipo+')').attr('selected', 'selected');
			$('#cargo option:contains('+this.cargo+')').attr('selected', 'selected');
			psw.val('');
		});
		that.Modall.modal('show');	
	}
}

HoneyUsers.prototype = HoneyHope;

var hu = new HoneyUsers();

$(document).ready(function(){
	hu.CargaCombo();
	hu.CargaTabla(0);
});
