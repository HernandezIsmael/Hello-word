function HoneyImgs() {
	HoneyHope.apply(this, [$("#btn_creimg"), $("#btn_updimg"), $("#btn_delimg"), $('<tbody></tbody>').attr('id', 'tbody_img'), $("#modal-images")]);
	var Clave = $("#clv_image"), Producto = $("#sel_pro"), token = $("#token_img").val(), that = this;

	$("#btn_newimg").click(function(){
		that.Modal(this, 1);
	});

	that.btn1.click(function(){
		that.SubirImagen(1);
	});

	that.btn2.click(function(){
		that.SubirImagen(2);
	});

	that.btn3.click(function(){
		that.Route = "/imagespro/"+Clave.val()+"";
	    that.Types = "DELETE";
	    that.Datos = { Id : Clave.val(), Vch_Ruta : this.nombre, IdPro : Producto.val(), Vch_Tipo : 'Eliminar' };
	    that.Ajax(token);	
	});

	$(document).on('click', '#btn_editimg', function(e){
		e.preventDefault();
		that.Route = "/imagespro/"+this.value+"/edit";
		that.Types = "GET";
		that.Modal(this, 2);
	});

	$(document).on('click', '#btn_deleteimg', function(e){
		e.preventDefault();
		that.Route = "/imagespro/"+this.value+"/edit";
		that.Types = "GET";
		that.Modal(this, 3);	
	});

	$(document).on('click', '.pagination a', function(e){
		e.preventDefault();
		that.page = $(this).attr('href').split('page=')[1];
		that.Route = "/imagespro";
		that.Pagination();	
	});

	that.SubirImagen = function(value){
		Image = $("#ruta_image").prop("files")[0];
		var form_data = new FormData();                  
        form_data.append("Vch_Ruta", Image);  
		$.ajax({
			url: "/uploadimgpro",
			headers: {'X-CSRF-TOKEN' : token },
			type: 'POST',
			data: form_data,
			processData: false,
            contentType: false,
            success : function(response){
            	$(response).each(function(){
            		if(value == 1){
	            		that.Route = "/imagespro";
		            	that.Types = "POST";
		            	that.Datos = { Id : Clave.val(), Vch_Ruta : this.nombre, IdPro : Producto.val(), Vch_Tipo : 'Insertar' };
		            	that.Ajax(token);
	            	}else{
	            		that.Route = "/imagespro/"+Clave.val()+"";
	            		that.Types = "PUT";
	            		that.Datos = { Id : Clave.val(), Vch_Ruta : this.nombre, IdPro : Producto.val(), Vch_Tipo : 'Actualizar' };
	            		that.Ajax(token);
	            	}	
            	});
            },
            error : function(){
            	alert("error");
            }
		});
	}

	that.CargaTabla = function(value){
		that.Route = "/imagespro";
		that.tabla.empty();
		$.get(that.Route, function(response){
			if(value == 1){ that.CargaDatosTabla(); }else{ that.CargaDatosTabla(1, response); } 
		});
	}

	that.CargaDatosTabla = function(pagination = 0, data = null){
		that.Route = "/tableimgs";
		that.page = (pagination == 0)? that.page = 1 : that.page = pagination;
		that.tabla.empty();
		$.ajax({
			url: that.Route,
			data: { page : that.page },
			type: 'GET',
			dataType: 'json',
			beforeSend: function(){
				$('.preloader').show();
			},
			success : function(response){
				$(response.data).each(function(){
					that.tabla.append("<tr><td>"+this.id_image+"</td>"+
						"<td><img src='images/"+this.Vch_Ruta+"' style='width:100px;'></td><td>"+this.Vch_NombreProducto+"</td>"+
						"<td><button class='btn btn-success' id='btn_editimg' value="+this.id_image+">Editar</button></td>"+
						"<td><button class='btn btn-danger' id='btn_deleteimg' value="+this.id_image+">Eliminar</button></td></tr>");
				});
				$("#tableimg").append(that.tabla);
				if(data != null){ $("#render").html(data); }
				$('.preloader').hide(); 
			}
		});
	}	

	that.CargaCombo = function(){
		$.ajax({
			url: "/comboimg",
			type: 'GET',
			dataType: 'json',
			success : function(response){
				$(response).each(function(){
					var option = $(document.createElement('option'));
					option.val(this.Vch_IdProducto);
					option.text(this.Vch_NombreProducto);
					$(Producto).append(option);
				});
			},
			error : function(){
				alert(that.getMsj_Error());	
			}	
		});
	}

	that.LlenaModal = function(response){
		$(response).each(function(){
			$("#ruta_image").empty();
			Clave.val(this.id_image);
			$('#sel_pro option:contains('+this.Vch_NombreProducto+')').attr('selected', 'selected');
		});
		that.Modall.modal('show');	
	}

}

HoneyImgs.prototype = HoneyHope;
var HI = new HoneyImgs();

$(document).ready(function(){
	HI.CargaTabla(0);
	HI.CargaCombo();
});

